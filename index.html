<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DÃ¼nyaya NasÄ±l BakÄ±yorsun</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #f3f4f6;
            padding: 1rem;
            text-align: center;
        }
        .card {
            background-color: #ffffff;
            border-radius: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 2.5rem;
            width: 100%;
            max-width: 32rem;
            position: relative;
        }
        .question-text {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 2rem;
        }
        .option-button {
            display: block;
            width: 100%;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 0.75rem;
            font-weight: 600;
            transition: background-color 0.3s, transform 0.1s;
            cursor: pointer;
            text-align: left;
            color: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .start-button {
            padding: 1rem 2.5rem;
            font-size: 1.25rem;
            font-weight: 700;
            border-radius: 9999px;
            background-color: #6366f1;
            color: #ffffff;
            transition: background-color 0.3s, transform 0.1s;
            cursor: pointer;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .start-button:hover {
            background-color: #4f46e5;
        }
        .start-button:active {
            transform: scale(0.98);
        }
        .result-text {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 1.5rem;
        }
        .result-message {
            font-size: 1.125rem;
            color: #4b5563;
        }
        .answers-list {
            list-style-type: none;
            padding: 0;
            margin-top: 1.5rem;
            text-align: left;
        }
        .answers-list li {
            background-color: #f9fafb;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .message-box {
            position: absolute;
            top: 1rem;
            left: 50%;
            transform: translateX(-50%);
            background-color: #fee2e2;
            color: #b91c1c;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: opacity 0.3s ease-in-out;
            opacity: 0;
        }
        .message-box.show {
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

<div class="container">

    <!-- BaÅŸlangÄ±Ã§ EkranÄ± -->
    <div id="start-screen" class="card">
        <h1 class="text-3xl font-bold text-gray-800 mb-4">Ã‡ok Ciddi(!) Bilimsel Bir Test</h1>
        <p class="text-gray-600 mb-2">DÃ¼nyaca Ã¼nlÃ¼ profesÃ¶rler (yok aslÄ±nda) tarafÄ±ndan hazÄ±rlandÄ±.</p>
        <p class="text-gray-600 mb-8">5 soruya cevap ver, sana Ã¶zel sonucu Ã¶ÄŸren.</p>
        <input type="text" id="nickname-input" class="w-full p-3 rounded-lg border-2 border-gray-300 mb-4 focus:outline-none focus:border-blue-500" placeholder="Takma adÄ±nÄ± gir...">
        <button id="start-button" class="start-button">Teste BaÅŸla</button>
        <div id="message-box" class="message-box">LÃ¼tfen bir takma ad girin.</div>
    </div>

    <!-- Test EkranÄ± (BaÅŸlangÄ±Ã§ta gizli) -->
    <div id="quiz-screen" class="card hidden">
        <div id="question-text" class="question-text"></div>
        <div id="options-container" class="mt-8"></div>
    </div>

    <!-- SonuÃ§ EkranÄ± (BaÅŸlangÄ±Ã§ta gizli) -->
    <div id="result-screen" class="card hidden">
        <h2 id="result-nickname-text" class="result-text"></h2>
        <p id="result-message" class="result-message"></p>
        <button id="restart-button" class="start-button mt-6">Tekrar BaÅŸla</button>
    </div>

</div>

<script type="module">
    // Firebase kÃ¼tÃ¼phanelerini import edin
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, getDocs, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
    import { getAnalytics, logEvent } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-analytics.js";

    // Firebase yapÄ±landÄ±rmasÄ±nÄ± ve uygulama kimliÄŸini tanÄ±mlayÄ±n
    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
    const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
    const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

    // Firebase ve Firestore'u baÅŸlatÄ±n
    let app, db, auth, analytics, userId;
    let authReady = false;

    try {
        app = initializeApp(firebaseConfig);
        db = getFirestore(app);
        auth = getAuth(app);
        analytics = getAnalytics(app);

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                userId = user.uid;
            } else {
                userId = crypto.randomUUID();
                await signInAnonymously(auth);
            }
            authReady = true;
        });

        if (initialAuthToken) {
            signInWithCustomToken(auth, initialAuthToken).catch(error => console.error("Firebase Auth hatasÄ±:", error));
        } else {
            signInAnonymously(auth).catch(error => console.error("Firebase Auth hatasÄ±:", error));
        }

    } catch (error) {
        console.error("Firebase baÅŸlatma hatasÄ±:", error);
    }
    
    // Sorular ve seÃ§enekleri
    const questions = [
        {
            question: "Sabah uyanÄ±r uyanmaz ilk iÅŸin ne olur?",
            options: [
                "Kahveye saldÄ±rÄ±rÄ±m â˜•",
                "Telefona bakarÄ±m ðŸ“±",
                "Battaniyeye sarÄ±lÄ±p â€œ5 dakika dahaâ€ derim ðŸ˜´"
            ]
        },
        {
            question: "Toplu taÅŸÄ±ma aracÄ± aniden sert fren yaptÄ± ve yanÄ±ndaki yabancÄ±nÄ±n Ã¼stÃ¼ne dÃ¼ÅŸtÃ¼nâ€¦",
            options: [
                "â€œBiz evlendik mi ÅŸimdi?â€ diye sorarÄ±m ðŸ’",
                "AyaÄŸa kalkÄ±p ciddi ciddi â€œÃ¶zÃ¼r dilerimâ€ derim ðŸ¤“",
                "UtanÄ±p sanki ben deÄŸil o dÃ¼ÅŸmÃ¼ÅŸ gibi davranÄ±rÄ±m ðŸ˜…"
            ]
        },
        {
            question: "Telefonun ÅŸarjÄ± %1 ve priz yokâ€¦ Ne yaparsÄ±n?",
            options: [
                "Paniklerim, dÃ¼nyam kararÄ±r ðŸ˜±",
                "â€œOh be, biraz kafam dinlenecekâ€ derim ðŸ˜Œ",
                "BaÅŸkasÄ±nÄ±n ÅŸarj aletine gizlice dadanÄ±rÄ±m ðŸ”Œ"
            ]
        },
        {
            question: "Yolda yÃ¼rÃ¼rken ayaÄŸÄ±n taÅŸa takÄ±ldÄ±, ne yaparsÄ±n?",
            options: [
                "â€œBenim suÃ§um deÄŸil taÅŸ suÃ§lu!â€ derim ðŸª¨",
                "Sanki dans figÃ¼rÃ¼ymÃ¼ÅŸ gibi devam ederim ðŸ’ƒ",
                "UtanÄ±p telefonla oynuyormuÅŸ gibi yaparÄ±m ðŸ“±"
            ]
        },
        {
            question: "Bir pizzayÄ± nasÄ±l yersin?",
            options: [
                "Dilim dilim, efendi efendi ðŸ•",
                "KatlayÄ±p dÃ¼rÃ¼m gibi yerim ðŸŒ¯",
                "Peyniri sÄ±yÄ±rÄ±p ayrÄ±, hamuru ayrÄ± yerim ðŸ˜‹"
            ]
        }
    ];

    // 20 farklÄ± sonuÃ§ mesajÄ±
    const results = [
        "HayatÄ±n her anÄ±na bahane bulup eÄŸlence Ã§Ä±karan bir ruh var sende.",
        "Ä°nsanlar seni ciddiye almaya Ã§alÄ±ÅŸsa da iÃ§indeki mizah hep kazanÄ±yor.",
        "Basit ÅŸeyleri bile ÅŸova Ã§evirmekte ustasÄ±n.",
        "Kaos Ã§Ä±ktÄ±ÄŸÄ±nda bile soÄŸukkanlÄ±lÄ±ÄŸÄ±nÄ± kaybetmeyen nadir tiplerdensin.",
        "Tuhaf ama sevimli bir enerji yayÄ±yorsun.",
        "Ã‡oÄŸu kiÅŸi seni tahmin edemez; sÃ¼rprizlerle dolusun.",
        "Biraz garip ama kesinlikle unutulmaz bir karaktere sahipsin.",
        "HayatÄ±ndaki aksilikleri bile eÄŸlenceli hale getirebiliyorsun.",
        "Her ortamda dikkat Ã§ekmeyi baÅŸarÄ±yorsun, farkÄ±nda olmasan bile.",
        "Ä°nsanlarÄ±n yÃ¼zÃ¼nÃ¼ gÃ¼ldÃ¼rmek senin gizli sÃ¼per gÃ¼cÃ¼n.",
        "BaÅŸÄ±na gelen gariplikler seni pes ettirmek yerine komikleÅŸtiriyor.",
        "Enerjin bazen fazla ama her zaman bulaÅŸÄ±cÄ±.",
        "â€œNe olursa olsun bir yolunu bulurumâ€ kafasÄ±ndasÄ±n.",
        "Her dÃ¼ÅŸÃ¼ÅŸÃ¼ dansa Ã§evirecek kadar yaratÄ±cÄ± bir ruhun var.",
        "GÃ¼ndelik hayatÄ± bile sit-com gibi yaÅŸamayÄ± baÅŸarÄ±yorsun.",
        "Normal olmak sana sÄ±kÄ±cÄ± geliyor, farklÄ± olmak ise eÄŸlenceli.",
        "Hem sakar hem de sempatik bir yanÄ±n var, ikisi de sende Ã§ok iyi duruyor.",
        "Ä°nsanlarÄ±n yanÄ±nda asla sÄ±kÄ±cÄ± bir an yaÅŸanmÄ±yor.",
        "Hayat sana limon verse sen ondan stand-up show Ã§Ä±karÄ±rsÄ±n.",
        "Kaotik enerjinle her ortamda unutulmaz izler bÄ±rakÄ±yorsun."
    ];

    let currentQuestionIndex = 0;
    let score = 0;
    let userNickname = '';

    const startScreen = document.getElementById('start-screen');
    const quizScreen = document.getElementById('quiz-screen');
    const resultScreen = document.getElementById('result-screen');
    const startButton = document.getElementById('start-button');
    const nicknameInput = document.getElementById('nickname-input');
    const messageBox = document.getElementById('message-box');
    const questionText = document.getElementById('question-text');
    const optionsContainer = document.getElementById('options-container');
    const resultNicknameText = document.getElementById('result-nickname-text');
    const resultMessage = document.getElementById('result-message');
    const answersList = document.getElementById('answers-list');

    // BaÅŸlangÄ±Ã§ butonuna tÄ±klama olayÄ±nÄ± dinle
    startButton.addEventListener('click', startGame);

    // SonuÃ§ ekranÄ±ndaki "Tekrar BaÅŸla" butonuna tÄ±klama olayÄ±nÄ± dinle
    const restartButton = document.getElementById('restart-button');
    restartButton.addEventListener('click', restartTest);

    // Testi baÅŸlatan fonksiyon
    async function startGame() {
        if (!authReady) {
            console.log("Kimlik doÄŸrulama bekleniyor...");
            return;
        }
        
        userNickname = nicknameInput.value.trim();
        if (userNickname === '') {
            messageBox.classList.add('show');
            setTimeout(() => {
                messageBox.classList.remove('show');
            }, 3000);
            return;
        }

        startScreen.classList.add('hidden');
        quizScreen.classList.remove('hidden');
        currentQuestionIndex = 0;
        score = 0;

        // Her yeni test baÅŸladÄ±ÄŸÄ±nda Ã¶nceki cevaplarÄ± temizle
        const answersRef = collection(db, `artifacts/${appId}/users/${userId}/quiz_answers`);
        const answersSnapshot = await getDocs(answersRef);
        answersSnapshot.forEach(doc => {
            deleteDoc(doc.ref).catch(e => console.error("Cevap silme hatasÄ±:", e));
        });

        // Firebase Analytics'e testin baÅŸladÄ±ÄŸÄ±nÄ± kaydet
        logEvent(analytics, 'quiz_started', { user_id: userId, nickname: userNickname });

        showQuestion();
    }

    // Soruyu ekrana yazdÄ±ran fonksiyon
    function showQuestion() {
        if (currentQuestionIndex < questions.length) {
            const currentQuestion = questions[currentQuestionIndex];
            questionText.textContent = `${currentQuestionIndex + 1}. ${currentQuestion.question}`;
            optionsContainer.innerHTML = '';

            const colors = ['#f59e0b', '#10b981', '#ef4444', '#6366f1', '#ec4899'];
            const shuffledColors = colors.sort(() => 0.5 - Math.random());

            currentQuestion.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.textContent = option;
                button.classList.add('option-button');
                button.dataset.index = index;
                button.style.backgroundColor = shuffledColors[index];
                button.addEventListener('click', () => selectOption(currentQuestion.question, option, index));
                optionsContainer.appendChild(button);
            });
        } else {
            showResult();
        }
    }

    // SeÃ§eneÄŸi iÅŸleyen fonksiyon
    async function selectOption(question, answer, answerIndex) {
        // Her cevaba puan ekle: A=0, B=1, C=2
        score += answerIndex;

        try {
            const answersRef = collection(db, `artifacts/${appId}/users/${userId}/quiz_answers`);
            await addDoc(answersRef, {
                nickname: userNickname,
                question: question,
                answer: answer,
                createdAt: new Date()
            });
            // Firebase Analytics'e her cevabÄ± kaydet
            logEvent(analytics, 'question_answered', { question: question, answer: answer, nickname: userNickname });
        } catch (e) {
            console.error("Firebase'e cevap ekleme hatasÄ±: ", e);
        }

        setTimeout(() => {
            currentQuestionIndex++;
            showQuestion();
        }, 500);
    }

    // Sonucu gÃ¶steren fonksiyon
    function showResult() {
        quizScreen.classList.add('hidden');
        resultScreen.classList.remove('hidden');
        
        resultNicknameText.textContent = `HoÅŸ Geldin, ${userNickname}!`;

        // 0-10 arasÄ±ndaki puanÄ± 0-19 aralÄ±ÄŸÄ±ndaki sonuÃ§ indekslerine dÃ¶nÃ¼ÅŸtÃ¼r
        const resultIndex = Math.floor(score * 2);

        // OlasÄ± sonuÃ§ indeksini sÄ±nÄ±rlarÄ±n iÃ§inde tut
        const finalIndex = Math.min(resultIndex, results.length - 1);
        
        resultMessage.textContent = results[finalIndex];
    }

    // Testi yeniden baÅŸlatan fonksiyon
    function restartTest() {
        resultScreen.classList.add('hidden');
        startScreen.classList.remove('hidden');
        nicknameInput.value = '';
    }
</script>

</body>
</html>
